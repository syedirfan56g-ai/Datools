<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Background Remover - DaTools</title>
  <meta name="description" content="Remove image backgrounds instantly with AI. Free online background remover tool. No registration required.">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>DaTools - Free Background Remover</h1>
  </header>

  <main>
    <section class="upload-section">
      <div class="upload-area" id="uploadArea">
        <div class="upload-icon">üìÅ</div>
        <div class="upload-text">Drag & drop image or browse to upload</div>
        <div class="file-types">Accept JPEG, JPG, PNG, WebP up to 40MB</div>
        <input type="file" id="fileInput" accept=".jpeg,.jpg,.png,.webp" style="display:none;">
      </div>

      <div class="preview-container">
        <img id="imagePreview" alt="Preview" style="display:none; max-width:100%; margin-top:1rem;">
        <button id="removeImage" style="display:none; margin-top:0.5rem;">‚ùå Remove</button>
      </div>
    </section>
  </main>

  <footer>
    <p>¬© 2025 DaTools.site - All rights reserved.</p>
  </footer>

  <script>
    const fileInput = document.getElementById("fileInput");
    const uploadArea = document.getElementById("uploadArea");
    const imagePreview = document.getElementById("imagePreview");
    const removeImageBtn = document.getElementById("removeImage");
    const previewContainer = document.querySelector(".preview-container");

    // Upload triggers
    uploadArea.addEventListener("click", () => fileInput.click());
    uploadArea.addEventListener("dragover", e => {
      e.preventDefault();
      uploadArea.classList.add("dragover");
    });
    uploadArea.addEventListener("dragleave", () => uploadArea.classList.remove("dragover"));
    uploadArea.addEventListener("drop", e => {
      e.preventDefault();
      uploadArea.classList.remove("dragover");
      if (e.dataTransfer.files.length) handleFileUpload(e.dataTransfer.files[0]);
    });
    fileInput.addEventListener("change", e => {
      if (e.target.files.length) handleFileUpload(e.target.files[0]);
    });

    // Handle file upload + API call
    async function handleFileUpload(file) {
      const allowedTypes = ["image/jpeg", "image/jpg", "image/png", "image/webp"];
      if (!allowedTypes.includes(file.type)) {
        alert("Please upload a valid image file (JPEG, JPG, PNG, WebP)");
        return;
      }
      if (file.size > 40 * 1024 * 1024) {
        alert("File size must be less than 40MB");
        return;
      }

      // Show loading
      imagePreview.src = "";
      imagePreview.style.display = "block";
      imagePreview.alt = "Processing...";
      imagePreview.style.opacity = "0.6";

      try {
        const formData = new FormData();
        formData.append("image", file);

        const res = await fetch("https://syedirfan56g.workers.dev/bg-remover", {
          method: "POST",
          body: formData
        });

        if (!res.ok) throw new Error("API request failed");

        const blob = await res.blob();
        const url = URL.createObjectURL(blob);

        // Show processed image
        imagePreview.src = url;
        imagePreview.style.opacity = "1";
        removeImageBtn.style.display = "inline-block";

        // Add download button
        let oldLink = document.getElementById("downloadLink");
        if (oldLink) oldLink.remove();

        const link = document.createElement("a");
        link.id = "downloadLink";
        link.href = url;
        link.download = "background-removed.png";
        link.textContent = "‚¨áÔ∏è Download Image";
        link.style.display = "block";
        link.style.marginTop = "1rem";
        previewContainer.appendChild(link);

      } catch (err) {
        console.error(err);
        alert("Failed to process image. Please try again.");
        imagePreview.style.display = "none";
      }
    }

    // Remove image + reset
    removeImageBtn.addEventListener("click", e => {
      e.stopPropagation();
      imagePreview.style.display = "none";
      removeImageBtn.style.display = "none";
      fileInput.value = "";
      let oldLink = document.getElementById("downloadLink");
      if (oldLink) oldLink.remove();
    });
  </script>
</body>
</html>
